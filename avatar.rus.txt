**********************************************************************
FGHI                                FIDONET GLOBAL HYPERTEXT INTERFACE
**********************************************************************
Статус:         черновик
Номер редакции: первоначальный оконченный черновик
Заглавие:       Фидонетовские аватары
Автор:          Mithgol the Webmaster   (aka Sergey Sokoloff, 2:50/88)
Дата редакции:  27 Feb 2016
-+--------------------------------------------------------------------
Содержание:
   1. Статус этого документа
   2. Введение
   3. Ключевые слова для выражения уровней требуемости
   4. Кладжи
   5. Кладж AVATAR
   6. Кладж GIF
   7. Кладж GRAVATAR
   8. Кладж AVAKEY
   Приложение A. Известные реализации
-+--------------------------------------------------------------------

1. Статус этого документа
-+-----------------------

  Этот документ является переводом на русский язык, соответствующим
  черновику Предлагаемого Фидонетовского Стандарта (FSP).

  Оригинал этого документа описывает необязательный фидонетовский
  стандарт, который может использоваться фидошным сообществом.

  Реализация стандарта, определённого в этом документе, не является
  необходимою; но ожидается, что все реализации будут соответствовать
  данному стандарту.

  Распространение этого документа не ограничивается, если в его текст
  при распространении не будут внесены изменения, не упомянутые явно.

2. Введение
-+---------

  Фидонетовскими аватарами являются картинки, служащие графическим
  представлением отдельных авторов эхопочтовых и нетмейловых сообщений
  в Фидонете.

  Этот документ определяет простой, основанный на кладжах, метод
  задания аватара, представляющего автора сообщения.

3. Ключевые слова для выражения уровней требуемости
-+-------------------------------------------------
  
  Ключевые слова "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
  "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY" и
  "OPTIONAL" в оригинале этого документа имеют смысл, соответствующий
  описаниям в стандарте FTA-1006 (основанном на RFC 2119).

  В этом русском переводе используются следующие ключевые выражения:

  "MUST"            : "ДОЛЖЕН", "НАДО"
  "MUST NOT"        : "НЕ ДОЛЖЕН"
  "REQUIRED"        : "НЕОБХОДИМЫЙ", "ТРЕБУЕМЫЙ", "ТРЕБУЕТСЯ"
  "SHOULD"          : "НАДОБНО", "СЛЕДУЕТ"
  "SHOULD NOT"      : "НЕ СЛЕДУЕТ"
  "RECOMMENDED"     : "РЕКОМЕНДУЕМЫЙ", "РЕКОМЕНДУЕТСЯ"
  "NOT RECOMMENDED" : "НЕ РЕКОМЕНДУЕТСЯ"
  "MAY"             : "МОЖЕТ", "МОЖНО"
  "OPTIONAL"        : "НЕОБЯЗАТЕЛЬНЫЙ"

4. Кладжи
-+-------

  Кладжи (также известные под названием кладжевых строк или
  управляющих параграфов) -- это специальные строки, внедряемые
  в текстовое тело фидонетовского сообщения. Иногда кладжи
  обеспечивают поддержку новой адресации и другой управляющей
  информации, иногда они содержат элементы вспомогательных сведений
  об авторе сообщения (его местонахождение, номер ICQ, Jabber ID,
  реальное имя, играющая музыка, настроение, и т. п.). См. технические
  подробности в FTS-4000.

  Кладжам, определённым в следующих разделах, НЕОБХОДИМО иметь
  следующие четыре общие характеристики:

  1) Такому кладжу НЕ ДОЛЖНА предшествовать (ни непосредственно,
     ни иначе) ни одна из обыкновенных (т. е. некладжевых) строк
     сообщения. Другими словами, набор кладжей предшествует остальному
     телу сообщения, и эхопроцессор (тоссер) МОЖЕТ собрать и сохранить
     эти кладжи отдельно, например, в подполях заголовка сообщения
     JAM, или в контрольном блоке сообщения Squish (см. FSP-1037),
     и так далее.

  2) Каждая кладжевая строка ДОЛЖНА начинаться одиночным символом SOH
     (Ctrl+A, ASCII 1).

  3) За этим символом SOH немедленно ДОЛЖНО следовать имя кладжа,
     двоеточие и РЕКОМЕНДУЕМЫЙ НЕОБЯЗАТЕЛЬНЫЙ символ пробела.

  4) Остаток строки содержит значение этого кладжа.

5. Кладж AVATAR
-+-------------

  Именем этого кладжа служит "AVATAR" (без учёта регистра,
  без кавычек).

  Значением этого кладжа является URL аватара, означаемого для того
  сообщения, в котором появляется кладж.

  Этому URLу, однако, МОЖЕТ предшествовать одна или несколько
  НЕОБЯЗАТЕЛЬНЫХ подсказок, отделённых пробелами.

  Если такая подсказка является натуральным числом, её СЛЕДУЕТ
  понимать как размер (в байтах) файла аватара. За числом МОЖЕТ
  непосредственно следовать метрический постфикс, например, "k"
  (без кавычек) означает килобайты (1k = 1024 байта), "M" (без
  кавычек) означает мегабайты (1M = 1024k), "G" (без кавычек) означает
  гигабайты (1G = 1024M). Что делает подсказку короче, и ей проще
  поместиться во кладже перед URLом.

  Если такая подсказка является парою натуральных чисел, разделённых
  символом "x" или "X" (без кавычек), то эти символы СЛЕДУЕТ понимать
  как ширину и высоту (в пикселах) аватара. Например, аватар 300x50
  имеет 300 пикселов в ширину и 50 пикселов в высоту.

  (Браузеры Фидонета МОГУТ изменять размер аватар; однако, они МОГУТ
  использовать подсказки, чтобы выбрать аватар нужного размера, когда
  доступны несколько URLов аватара, как объясняется ниже.)

  Если дано несколько различных подсказок одного типа (например,
  "400x55 256x256" или "14k 8M"), подсказки эти НАДО игнорировать.
  Даже если дано несколько одинаковых подсказок одного типа (например,
  "400x55 400x55" или "14k 14k"), подсказки эти СЛЕДУЕТ игнорировать.

  В одном сообщении МОГУТ появляться несколько кладжей AVATAR. Они
  ДОЛЖНЫ содержать различные URLы по существу одного и того же
  изображения аватара, хотя изображение МОЖЕТ иметь другой размер
  и (или) быть обрезанным под другую ширину и высоту -- и, таким
  образом, браузер Фидонета ДОЛЖЕН иметь возможность выбрать любой
  из указанных URLов, не получив другой аватар.

  Другими словами, делаемый браузером выбор URLа источника аватара
  способен основываться на браузерной поддержке схем URLов, на
  доступности ресурсов, означенных в URLах (интернетовских серверов
  или сервисов, фидонетовских систем, фидонетовских эхопочтовых или
  файловых областей), на данных подсказках, и так далее. Этим
  стандартом дозволяется указывать во кладже любую схему URLа,
  например,

  *) схему "http:" или "https:" для аватар, размещённых в WWW,

  *) схему "ftp:" для аватар, размещённых на FTP,

  *) схему "magnet:" или "ed2k:" для аватар, доступных по файлообмену,

  *) схему "freq:" для аватар, доступных по фидонетовским
     файловым запросам,

  *) схему "faqserv:" для аватар, доступных в автоматических откликах,
     посылаемых фидонетовским нетмейлом так называемыми FAQ-серверами,

  *) схему "fecho:" для аватар, выложенных в фидонетовских фэхах,

  *) схему "area:" для аватар, выложенных в фидонетовской эхопочте.
     Между прочим, аватар и содержащее кладж сообщение МОГУТ быть
     расположены в разных областях эхопочты (например, если есть
     специальная эха для выкладывания UUE-закодированных аватар).

  Примечание 1: этот список примеров не является исчерпывающим.

  Примечание 2: последние четыре схемы (area, fecho, faqserv, freq)
  определены в стандарте FGHI URL. Доступен здесь:

  https://github.com/Mithgol/FGHI-URL/blob/master/FidoURL.rus.txt

  Примечание 3: если некоторый браузер Фидонета не поддерживает
  некоторую схему URLа, то МОЖЕТ игнорировать кладж AVATAR
  с этим URLом.

6. Кладж GIF
-+----------

  Именем этого кладжа служит "GIF" (без учёта регистра, без кавычек).

  Значением этого кладжа является имя файла аватара. Имя даётся
  без расширения, а расширение его всегда ".GIF" (без кавычек).
  Подразумевается, что файл доступен по файловому запросу на системе
  автора сообщения.

  Например, если автор сообщения имеет адрес 2:9999/88, то тогда
  следующие два кладжа эквивалентны:

      ^aGIF: SYSOP88

      ^aAVATAR: freq://2:9999/88/SYSOP88.GIF

  где "^a" обозначается символ SOH, а "freq://" является схемою URLов
  для файловых запросов (определённою в стандарте FGHI URL).

  Этот кладж определён для того, чтобы стандарт этот был обратно
  совместим с теми ранними версиями GoldED, в которых этот кладж
  действительно поддерживался.

  Если несколько кладжей GIF с различными значениями сосуществуют
  в одном сообщении, кладжи эти НАДО игнорировать. Даже если несколько
  кладжей GIF с одинаковыми значениями сосуществуют в одном сообщении,
  кладжи эти СЛЕДУЕТ игнорировать.

  Когда кладжи AVATAR и GIF сосуществуют в одном сообщении, браузер
  МОЖЕТ выбирать между ними так, как если бы кладж GIF был
  эквивалентным кладжем AVATAR.

7. Кладж GRAVATAR
-+---------------

  Именем этого кладжа служит "GRAVATAR" (без учёта регистра,
  без кавычек).

  Значением этого кладжа является 32-значное шестнадцатеричное число.
  Это хэш MD5 адреса e-mail, записанного строчными буквами. Например,
  если это адрес "SomeExample@example.org", то число будет выведено
  следующим кодом PHP:

     echo md5( strtolower( "SomeExample@example.org" ) );

  НЕ ДОЛЖНО быть пробелов ни до, ни после такого адреса e-mail, когда
  он передаётся вычислителю хэша MD5.

  Чтобы использовать этот кладж, автору сообщения придётся
  зарегистрировать свой адрес e-mail на http://gravatar.com/
  и опубликовать там свой аватар. Адрес e-mail (в отличие от аватара)
  не становится публичным, так как только хэш публикуется (в качестве
  значения кладжа) в Фидо.

  Затем браузер Фидонета способен по опубликованному хэшу получить
  аватар, как это по адресу http://gravatar.com/site/implement/images/
  разъясняется.

  Например, следующие два кладжа МОГУТ быть эквивалентны:

     ^aGRAVATAR: somehash

     ^aAVATAR: https://secure.gravatar.com/avatar/somehash?s=200&r=x

  (где "^a" обозначается символ SOH, а "somehash" обозначается
  некоторое реальное 32-разрядное шестнадцатеричное число).

  Значение параметра "s" в этом URLе СЛЕДУЕТ изменять для получения
  аватара нужного размера ("s=200" означает аватар 200x200, "s=333"
  означает аватар 333x333, и т. д.). Примеры:

  *) браузер Фидонета МОЖЕТ запросить аватары 20x20 для представления
     авторов в списке заглавий сообщений и аватар 200x200
     для представления автора в более крупном (многострочном)
     заголовке отдельного сообщения;

  *) некоторый JavaScript на WebBBS МОЖЕТ window.devicePixelRatio
     использовать как множитель для получения более крупных аватар
     для мобильных устройств с повышенной плотностью пикселов (таких,
     как Retina display от Apple).

  СЛЕДУЕТ использовать значение параметра "r" для указания одного из
  указанных ниже рейтингов и запрашивания изображений с этим рейтингом
  или одним из предшествующих ему рейтингов:

  r=g: годится для отображения на всех сайтах, для любой аудитории;

  r=pg: может содержать грубые жесты, провокационно одетых персонажей,
        не особенно бранную ругань, умеренное насилие;

  r=r: может содержать грубые ругательства, грубое насилие, обнажёнку,
       употребление сильнодействующих наркотических веществ и т. п.;

  r=x: может содержать жёсткое порно, крайнюю степень насилия.

  Если несколько кладжей GRAVATAR с различными значениями сосуществуют
  в одном сообщении, кладжи эти НАДО игнорировать. Даже если несколько
  кладжей GRAVATAR с одинаковыми значениями сосуществуют в одном
  сообщении, кладжи эти СЛЕДУЕТ игнорировать.

  Когда кладжи GRAVATAR и AVATAR и (или) GIF сосуществуют в одном
  сообщении, браузер МОЖЕТ выбирать между ними так, как если бы кладж
  GRAVATAR был эквивалентным кладжем AVATAR.

8. Кладж AVAKEY
-+-------------

  Именем этого кладжа служит "AVAKEY" (без учёта регистра,
  без кавычек).

  Значением этого кладжа является список ключевых слов, разделяемых
  символами "|" (без кавычек). Эти ключевые слова ДОЛЖНЫ
  соответствовать аватару, означенному для сообщения, в котором
  появляется кладж.

  Эти ключевые слова полезны, когда все URLы аватара указывают на
  некоторые ресурсы, не доступные немедленно, так что и сам аватар
  не доступен для немедленного отображения. Примеры:

  *) файлообменный URL, когда источники (сиды) файла в оффлайне;

  *) интернетовский URL, когда читательское устройство в оффлайне;

  *) URL файлового запроса, когда указанный узел (нода) в оффлайне.

  В таких обстоятельствах фидонетовский браузер МОЖЕТ временно
  показывать некоторый другой аватар, недавно использованный тем же
  автором в той же эхопочтовой области (или в нетмейле) при том
  условии, что другой аватар был употреблён с тем же ключевым словом.

  Если в сообщении присутствует единственный кладж AVAKEY, то ключевые
  слова НАДОБНО использовать в порядке их появления. Например, кладж

      ^aAVAKEY: smiling|very happy|seaside|default

  (где "^a" обозначается символ SOH) означает, что используется самый
  последний из доступных аватар с ключевым словом "smiling"; если же
  таких аватар нет, то самый последний из аватар "very happy", и т. д.

  Если в сообщении присутствует несколько кладжей AVAKEY, то порядок
  ключевых слов НЕ СЛЕДУЕТ принимать во внимание. Например, кладжи

      ^aAVAKEY: smiling|very happy
      ^aAVAKEY: seaside|default

  (где "^a" обозначается символ SOH) означают, что используется самый
  последний из аватар, обозначенных хотя бы одним из четырёх ключевых
  слов ("smiling", "very happy", "seaside" и "default").

  Если в сообщении не присутствует кладж AVAKEY, тогда ключевое слово
  "default" (без кавычек) ДОЛЖНО подразумеваться для аватара, если
  одним или несколькими остальными кладжами (AVATAR, GIF, GRAVATAR)
  означен URL некоторого аватара. Работает это в обе стороны:

  1) если аватар для такого сообщения не доступен немедленно, браузер
     Фидонета МОЖЕТ временно показать наиболее недавний из доступных
     аватар, использованных с ключевым словом "default",

  2) когда браузер Фидонета ищет аватары, использованные с ключевым
     словом "default", браузер ДОЛЖЕН также находить аватары,
     означенные в сообщениях с отсутствующими кладжами AVAKEY.

Приложение A. Известные реализации
-+--------------------------------

  Ко времени написания сего документа известны несколько реализаций
  черновых редакций сего стандарта.

  Эталонная реализация (свободный открытый код):

  https://github.com/Mithgol/node-fidonet-jam

  Приложения, написанные автором стандарта:

  *) PhiDo https://github.com/Mithgol/phido

  *) twi2fido https://github.com/Mithgol/node-twi2fido/

**********************************************************************
EOTD                                               END OF THE DOCUMENT
**********************************************************************